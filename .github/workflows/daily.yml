name: Daily Sectoral Deep-Dive

on:
  schedule:
    - cron: '30 3 * * *'  # 9:00 AM IST
  workflow_dispatch:      # Manual trigger

jobs:
  analyze_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: pip install pandas requests yfinance feedparser textblob python-pptx

      - name: Run Market Analysis
        id: run_script
        run: |
          python main.py
          # Store filename for next step
          FILE_PATH=$(ls reports/*.pptx | head -n 1)
          echo "REPORT_PATH=$FILE_PATH" >> $GITHUB_ENV

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        if: env.REPORT_PATH != ''
        with:
          # Uses Run ID to make every release unique and avoid retry errors
          tag_name: report-${{ github.run_id }}
          name: Market Analysis - $(date +'%d %b %Y')
          files: ${{ env.REPORT_PATH }}
          make_latest: true
          body: |
            ### ðŸ“‰ Strategic Market Intelligence
            Your non-zipped sectoral report is ready for download below.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
